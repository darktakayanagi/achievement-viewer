<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam Achievements Viewer</title>
    <style>
        /* Your existing CSS here */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÆ Steam Achievements Viewer</h1>
            <p>Automatically loaded from AppID folders</p>
        </header>

        <div id="info" class="info" style="display: none;">
            <h3>üìÅ Folder Structure Expected:</h3>
            <p>Place your achievement files in: <code>AppID/&lt;game-appid&gt;/achievements.json</code></p>
        </div>

        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <div>Scanning for achievement files...</div>
        </div>

        <div id="summary" style="display: none;"></div>
        <div id="results"></div>
    </div>

    <script>
        const gamesData = new Map();

        async function init() {
            document.getElementById('loading').style.display = 'block';

            try {
                const response = await fetch('AppID/'); // fetch the directory listing
                const text = await response.text();
                const folderRegex = /href="(\d+)\/?"/g;
                let match;
                const appIdsToLoad = [];

                while ((match = folderRegex.exec(text)) !== null) {
                    appIdsToLoad.push(match[1]);
                }

                if (appIdsToLoad.length === 0) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('info').style.display = 'block';
                    document.getElementById('results').innerHTML = `
                        <div class="error">
                            <h3>‚ö†Ô∏è No AppID folders found</h3>
                            <p>Create folders under <code>AppID/&lt;game-appid&gt;/achievements.json</code></p>
                        </div>
                    `;
                    return;
                }

                for (let appId of appIdsToLoad) {
                    await loadGame(appId);
                }

            } catch (error) {
                console.error('Error scanning AppID folders:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('info').style.display = 'block';
            }

            document.getElementById('loading').style.display = 'none';
            displayGames();
        }

        async function loadGame(appId) {
            try {
                const response = await fetch(`AppID/${appId}/achievements.json`);
                if (!response.ok) return;

                const data = await response.json();
                await processGameData(appId, data);

            } catch (error) {
                console.warn(`Error loading achievements for ${appId}:`, error);
            }
        }

        async function processGameData(appId, achievementsData) {
            let gameName = `Game ${appId}`;
            let gameIcon = '';

            try {
                const storeResponse = await fetch(`https://store.steampowered.com/api/appdetails?appids=${appId}`);
                const storeData = await storeResponse.json();
                if (storeData[appId] && storeData[appId].success) {
                    gameName = storeData[appId].data.name;
                    gameIcon = storeData[appId].data.header_image;
                }
            } catch (error) {
                console.log(`Could not fetch store data for ${appId}`);
            }

            const achievements = [];
            let achData = achievementsData.achievements || achievementsData;
            for (let key in achData) {
                const ach = achData[key];
                achievements.push({
                    apiname: key,
                    name: ach.name || ach.displayName || key,
                    description: ach.description || ach.desc || '',
                    icon: ach.icon || '',
                    icongray: ach.icongray || ach.icon_gray || ach.icon || '',
                    unlocked: ach.earned || ach.unlocked || ach.achieved || false,
                    unlocktime: ach.earned_time || ach.unlock_time || ach.unlocktime || 0
                });
            }

            gamesData.set(appId, { appId, name: gameName, icon: gameIcon, achievements });
        }

        function displayGames() {
            // Same display logic as your original script
        }

        function toggleAchievements(cardId) {
            const list = document.getElementById(cardId);
            const button = event.target;
            if (list.classList.contains('collapsed')) {
                list.classList.remove('collapsed');
                button.textContent = 'Hide Achievements';
            } else {
                list.classList.add('collapsed');
                button.textContent = 'Show Achievements';
            }
        }

        init();
    </script>
</body>
</html>
